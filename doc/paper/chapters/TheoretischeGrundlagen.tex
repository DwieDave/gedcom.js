\chapter{Theoretische Grundlagen}
\label{chap: Theoretische Grundlagen}
In diesem Kapitel...

\section{Genealogie und FamilySearch}
\label{sec: Genealogie und FamilySearch}
Genealogie ist ein Überbegriff für die Familien- und Ahnenforschung und beschäftigt sich mit der historischen Herkunft und der Geschichte von Menschen weltweit \cite{AhnenforschungDE}. Dabei sind insbesondere Abstammungs- und Verwandtschaftsverhältnisse von besonderer Bedeutung, die anhand von Beiweisen aus validen Quellen in Stammbäumen zusammengefasst werden, die aufzeigen, wie eine Generation mit der nächsten verbunden ist. Auf Basis der so erlangten Erkenntnisse kann eine Familiengeschichte erstellt werden, die eine biographische Studie einer genealogisch nachgewiesenen Familie und der Gemeinde in der sie lebten, darstellt \cite{SocietyOfGenealogists}.

Das Aufkommen des Internets stellte einen Wendepunkt in der Genealogie dar. 

\section{GEDCOM Version 7}
\label{sec: GEDCOM Version 7}
Das Datenformat FamilySearch GEDCOM 7.0 wurde 2021 von der Kirche Jesu Christi der Heiligen der Letzten Tage entwickelt und stellt ein einheitliches, flexibles Format für den Austausch von genealogischen Daten bereit. Das Ziel besteht darin, eine langfristige Speicherung von genealogischen Informationen zu ermöglichen, die für zukünftige Genealogen und die von ihnen verwendeten System zugänglich und verständlich ist \cite{GEDCOM}. Die im Rahmen dieser Arbeit verwendete Version 7.0.11 wurde am 01.11.2022 veröffentlicht und stellt die aktuelleste\footnote{Stand 31.01.2023} Version des Standards dar. 

GEDCOM ist ein UTF-8 kodiertes hierarchisches Containerformat, das die Dateinamenserweiterung \textit{.ged} verwendet. Der erste Character einer GEDCOM-Datei sollte das Byte-Order-Mark (U+FEFF) sein. Der Inhalt einer GEDCOM-Datei ist in sog. \textit{Structures} unterteilt, die aus einem \textit{Structure Type} und einem optionalen \textit{Payload} bestehen und mehrere Substrukturen besitzen können. Hat eine \textit{Structure} eine \textit{Substructure}, dann ist die \textit{Structure} die \textit{Superstructure} der \textit{Structure}. Jede \textit{Substructure} hat genau eine \textit{Superstructure} und ist so in der Gesamtstruktur eindeutig zugeordnet. Eine \textit{Structure}, die keine \textit{Supertructure} besitzt, heißt \textit{Record}. Alle Records zusammen mit einer \textit{Header}- und einer \textit{Trailer}-Struktur bilden ein \textit{Dataset}, das den Inhalt einer GEDCOM-Datei darstellt. \cite{GEDCOM} 

Der \textit{Payload} einer \textit{Structure} ist eine Zeichenkette eines bestimmten Datentyps, die entweder Informationen für die \textit{Supertructure} bereithält, oder einen Zeiger auf eine andere \textit{Structure} repräsentiert und somit auf diese verweist. GEDCOM v7 definiert 11 verschiedene Datentypen in \cite{GEDCOM} mit denen Namen, Daten, Uhrzeiten, Texte und vieles mehr dargestellt werden können. Der \textit{Structure Type} ist eindeutig definiert durch eine URI und gibt an, welche Bedeutung und welchen Datentyp die \textit{Structure} besitzt, welche \textit{Substructures} enthalten sein können und mit welcher Kardinalität diese auftreten können. \cite{GEDCOM} 

Kodiert wird der Inhalt einer GEDCOM-Datei in sog. \textit{Lines}, die eine Zeichenkettenrepräsentation einer Struktur (bzw. eines Teils einer Struktur) darstellen und wie folgt aufgebaut sind (eckige Klammern repräsentieren optionale Inhalte):
\begin{center}
	Level  D  [Xref  D]  Tag  [D  LineVal]  EOL
\end{center}
\begin{itemize}
	\item Level: Eine Line beginnt mit einem Level, das die Verhältnisse der \textit{Structures} untereinander beschreibt. Alle \textit{Structures} mit dem kleinstmöglichen Level $0$ sind Records - Level $\ge1$ repräsentieren \textit{Substructures}. Eine \textit{Structure} mit dem Level $x$ ist also die \textit{Superstructure} aller folgenden \textit{Structures} mit dem Level $x+1$.
	\item D: \textit{D} steht für \textit{Delimiter}, was englisch für Trennzeichen ist und repräsentiert in diesem Fall das Leerzeichen mit dem Unicode $u+0020$.
	\item Xref: Xref ist die Abkürzung für \textit{Cross-Reference Identifier} und fungiert als Adresse für eine \textit{Structure}. Möchte man von einer \textit{Structure} auf eine andere \textit{Structure} verweisen, kann dies über einen Zeiger-Payload auf die entsprechende \textit{Structure} realisiert werden.
	\item Tag: Der \textit{Tag} kodiert den \textit{Structure Type} einer \textit{Structure}.
	\item LineVal: Im \textit{LineVal} einer Struktur ist der Payload kodiert.
	\item EOL: EOL steht für End-Of-Line und kodiert das Ende einer Line. Im Format GEDCOM v7 kann dies entweder durch einen Carriage-Return (Unicode U+000D), Line-Feed(Unicode U+000A) oder einen Carriage-Return gefolgt von einem Line-Feed repräsentiert werden.
\end{itemize}
Ein Ausschnitt aus einer GEDCOM-Datei ist in \ref{lst: family record example} dargestellt. Dieser Ausschnitt zeigt einen \textit{Record} vom Typ \textit{Family}, in dem Informationen über eine Familie gespeichert werden können. Der Familie wurde der Cross-Reference Identifier \textit{@F1@} zugewiesen, sodass im Dokument auf dieses verwiesen werden kann. Der Ehemann und die Ehefrau der Familie (engl. Husband und Wife) sind die Individuen \textit{I1} und \textit{I2}, die ebenfalls in der Gedcom7-Datei definiert sind. Dieser Zusammenhang wird über die Cross-Reference Identifier \textit{@I1@} und \textit{@I2@} ausgedrückt. Außerdem wird ein Family-Event, nämlich die Hochzeit der beiden Ehepartner aufgeführt und auf den 1.März 1951 datiert. Als letzte Information ist die Anzahl der Kinder (NCHI: Number of Children) mit 2 spezifiziert.
\\ \\
\begin{minipage}{1.0\textwidth} \small
	\begin{lstlisting}
		0 @F1@ FAM
		1 HUSB @I1@
		1 WIFE @I2@
		1 MARR
		2 DATE 1 MAR 1951
		1 NCHI 2
	\end{lstlisting}
	\captionof{lstlisting}{Beispiel für einen Individual Record}
	\label{lst: family record example}
\end{minipage}
\\ \\
Detaillierte Erklärungen, alle Informationen zu \textit{Structure Types}, Datentypen, usw. und viele weitere Beispiele können in \cite{GEDCOM} nachgelesen werden.

% IDEE: Hier die Spezifikation vom Family Record aufführen und erklären. Dazu vielleicht von einer Substructure und sagen dass so die gesamte Spezifikation aufgebaut ist. Dann ein Beispiel einer Family und darauf in Konzept eingehen. Und am Beispiel dieser Family dann in Implementierung die Convinience Funktionen zeigen

\section{Nearley}
\label{sec: Nearley}
% TO-DO: EBNF erklären bzw. einmal ansprechen -> vielleicht schon im Gedcom-Kapitel?

\section{Mocha}
\label{sec: Mocha}

Da uns das Testen unserer Bibliothek wichtig war haben wir uns nach Beginn der ersten Implementierung
auf die Suche nach einem Testframework für JavaScript gemacht. Dabei sind wir auf Mocha gestoßen, welches
eine einfach API zum Erstellen von Tests bietet. Die Tests können dabei entweder synchron oder asynchron
sein und können, wie bei den meisten Testframeworks, mit Hilfe von Assertion-Funktionen überprüft werden.

\newpage

\begin{javascript}
  // ===========================================================
  // GEDCOM READING AND WRITING
  describe('test if gedcom file is equivalent before and after parsing', () => {
  	const path = 'test/sampleData/ExampleFamilySearchGEDCOMFiles/';
  	//correct files
  	const gedFiles = [
		'escapes.ged',
		'long-url.ged',
		'maximal70_without_extensions.ged',
		'minimal70.ged',
		'remarriage1.ged',
		'same-sex-marriage.ged',
		'voidptr.ged'
  	];

  	forEach(gedFiles)
		.it('#%s', async (fileName) => {
	  	// read Gedcom file as String
	  	const beforeParsing = await readGedFile(path + fileName);
	  	// parse Gedcom String and write it to temp.ged
	  	const dataset = gedcomParser.parseString(beforeParsing);
	  	await fs.writeFile(path + 'temp.ged', '');
	  	await dataset.write(path + 'temp.ged');
	  	// read temp.ged as String and compare it with original file
	  	const afterParsing = await readGedFile(path + 'temp.ged');

	  	// expect files to be equal
	  	expect(diffChars(beforeParsing, afterParsing)).to.have.lengthOf(1);
	});
  });
\end{javascript}